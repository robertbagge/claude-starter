---
argument-hint: <pr-number | pr-url>
description: Review GitHub PR and post comments
---

# review-gh

Review a GitHub PR and post summary comment + inline comments.

## Usage

```
/review-gh 123
/review-gh https://github.com/owner/repo/pull/456
```

## Workflow

### Step 1: Fetch PR Data

**YOU (the orchestrator) must:**

```bash
# Get PR metadata
gh pr view <pr> --json number,title,body,author,files,url

# Get PR diff
gh pr diff <pr>

# Get changed files list
gh pr view <pr> --json files --jq '.files[].path'
```

### Step 2: Detect Tech Areas

**YOU (the orchestrator) must:**

Map changed files to tech areas based on path patterns:

| Path Pattern | Tech Area |
|--------------|-----------|
| `mobile-app/**` | mobile-app |
| `supabase/**` | supabase |
| `go-api/**` | go-api |
| `services/**` | go-api |
| `infra/**` | infra |
| Other | (general) |

### Step 3: Launch Code Reviewer Orchestrator

**YOU (the orchestrator) must:**

Use Task tool with subagent_type="code-reviewer":

```
Task: Review code changes for PR #[number]

**PR Title:** [title]
**PR Description:** [body]

**Changed Files:**
[List each file with its diff from gh pr diff]

**Tech Areas:** [comma-separated detected areas, or "general" if none]

**Task Context:**
[PR description provides the task context]

Orchestrate the review across specialized reviewers and produce a unified review.
```

The code-reviewer orchestrator will:
1. Use PR description as task context
2. Smart-select reviewers based on tech areas
3. Launch reviewers in parallel (functionality, code-quality, security, performance, privacy)
4. Synthesize findings into unified output

### Step 4: Post Summary Comment

**YOU (the orchestrator) must:**

Convert agent output to summary comment and post it:

```bash
gh pr comment <pr> --body "$(cat <<'EOF'
## Code Review

**Verdict:** [APPROVE | REQUEST_CHANGES | COMMENT]

[Overview from agent]

### Strengths
- [Good patterns from agent]

### Priority Issues
1. ðŸ”´ [Critical] - `file:line`
2. ðŸŸ¡ [Warning] - `file:line`
3. ðŸ”µ [Suggestion] - `file:line`

---

*Review generated by /review-gh*
EOF
)"
```

### Step 5: Post Inline Comments

**YOU (the orchestrator) must:**

For each file comment from agent (limit to ~10 most important):

```bash
# Get commit ID and repo info
commit_id=$(gh pr view <pr> --json commits --jq '.commits[-1].oid')
owner=$(gh repo view --json owner --jq .owner.login)
repo=$(gh repo view --json name --jq .name)

# Post inline comment
gh api repos/{owner}/{repo}/pulls/<pr>/comments \
  -f body="[severity_emoji] **[Category]**

[Message]

[Details if short enough]

**References:**
- [reference links]" \
  -f path="<file_path>" \
  -f commit_id="$commit_id" \
  -F position=<line_number> \
  -f side="RIGHT"
```

**Severity Emojis:**
- ðŸ”´ Critical
- ðŸŸ¡ Warning
- ðŸ”µ Suggestion
- âœ… Good

**Important Notes:**
- Use `position` (line in diff), not `line` (line in file)
- Must include `commit_id` from PR
- For new files, position matches line number
- Limit inline comments to avoid spam (~10 max)

### Step 6: Output PR URL

**YOU (the orchestrator) must:**

```bash
echo "Review posted to PR:"
gh pr view <pr> --json url --jq .url
```

## DO

- Fetch full PR diff before launching agent
- Post summary comment first
- Post inline comments for specific issues (prioritize critical/warning)
- Use emoji prefixes consistently
- Include references in comments
- Limit inline comments to ~10 most important

## DO NOT

- Skip the summary comment
- Post too many inline comments (spam)
- Post generic/vague comments
- Fail if no tech area detected (use general principles)
- Post inline comments for "good" feedback (save for summary)
